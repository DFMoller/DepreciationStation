{% extends 'base.html' %}
{% block title %}Home{% endblock %}
{% block year_selection %}
<form id="year-form" class="year-form" action="" method="POST">
    <div class="radios-tab">
        <h3>Model Year:</h3>
        <div class="radios">
            {% for year in years: %}
                {% if year == year_selection: %}
                    <label for="radio-{{ year }}"><input onchange="reloadPage()" id="radio-{{ year }}" value="{{ year }}" type="radio" name="year-selection" checked>{{ year }}</label>
                {% else: %}
                    <label for="radio-{{ year }}"><input onchange="reloadPage()" id="radio-{{ year }}" value="{{ year }}" type="radio" name="year-selection">{{ year }}</label>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</form>
{% endblock %}
{% block main %}

<p class="info">The goal of Depreciation Station is to compare the rate at which different coloured cars depreciate and for this, data is obtained from Autotrader using Python and web scraping. The scraping is automated to run daily on a Raspberry Pi 4 model b while this web page is hosted on PythonAnywhere. Data is communicated between these two nodes using a Flask RESTful API and starting in April 2022, some time needs to pass for data to be accumulated before any insight can be gained into the depreciation rates of different coloured cars. Come back tomorrow to see the new recordings! (Best viewed on a big display)</p>

<div class="home-wrapper">
    <div class="chart-box">
        <canvas class="myChart" id="myChart"></canvas>
    </div>
</div>

{% endblock %}

{% block javascript %}
<script>

    function reloadPage(){

        var yearForm = document.getElementById("year-form");
        yearForm.submit();

    }

    document.addEventListener("DOMContentLoaded", function() {

        const labels = {{ xlabels | safe }};
        
        const data = {
            labels: labels,
            datasets: {{ datasets | safe }}
        };

        const background_plugin = {
            id: 'custom_canvas_background_color',
            beforeDraw: (chart) => {
            const {ctx} = chart;
            var chartArea = chart.chartArea
            ctx.save();
            ctx.globalCompositeOperation = 'destination-over';
            ctx.fillStyle = '#D4E5F0';
            // chartArea.left, chartArea.top, chartArea.right - chartArea.left, chartArea.bottom - chartArea.top
            //ctx.fillRect(0, 0, chart.width, chart.height);
            ctx.fillRect(chartArea.left, chartArea.top, chartArea.right - chartArea.left, chartArea.bottom - chartArea.top);
            ctx.restore();
            }
        };

        const config = {
            type: 'line',
            data: data,
            plugins: [background_plugin],
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#6C99B7',
                            padding: 15,
                            font: {
                                family: "Poppins",
                                //size: 12
                            }
                        }
                    },
                    title: {
                        display: true,
                        text: ['Median value per color for all cars', 'on Autotrader in {{ year_selection }}'],
                        font: {
                            size: 25,
                            family: "Poppins",
                            weight: 'normal'
                        },
                        color: '#6C99B7'

                    }
                },
                scales:{
                    y: {
                        type: 'linear',
                        title: "y",
                        display: true,
                        position: 'left',
                        ticks: {
                            color: '#6C99B7'
                        },
                        grid: {
                            borderColor: '#6C99B7'
                        }
                    },
                    xAxes: {
                        ticks: {
                            autoSkip: true,
                            maxTicksLimit: 15,
                            color: '#6C99B7'
                        },
                        grid: {
                            borderColor: '#6C99B7'
                        }
                    }
                },
                elements: {
                    point: {
                        radius: 0
                    },
                    line: {
                        borderWidth: 4,
                        cubicInterpolationMode: 'default',
                        borderJoinStyle: 'round',
                        borderCapStyle: 'round',
                        tension: 0.3
                    }
                }
            }
        };

        var ctx = document.getElementById("myChart").getContext("2d");

        var barchart = new Chart(ctx, config);
    });
</script>
{% endblock %}